<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoldenRecord Pro</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Simple Icon Component
        const Icon = ({ name, className = "w-5 h-5" }) => {
            const icons = {
                Database: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <ellipse cx="12" cy="5" rx="9" ry="3"/>
                        <path d="m3 5 0 14c0 1.7 4 3 9 3s9-1.3 9-3V5"/>
                        <path d="m3 12c0 1.7 4 3 9 3s9-1.3 9-3"/>
                    </svg>
                ),
                Upload: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <path d="m12 18-4-4h3V9h2v5h3l-4 4z"/>
                    </svg>
                ),
                Search: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                ),
                Download: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2v10"/>
                        <path d="m5 9 7 7 7-7"/>
                        <path d="M5 20h14"/>
                    </svg>
                ),
                CheckCircle: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22,4 12,14.01 9,11.01"/>
                    </svg>
                ),
                AlertTriangle: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
                        <path d="M12 9v4"/>
                        <path d="m12 17 .01 0"/>
                    </svg>
                ),
                FileText: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                ),
                Eye: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                ),
                Edit: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z"/>
                    </svg>
                )
            };
            return icons[name] || <div>{name}</div>;
        };

        // Utility Functions
        const parseCSV = (text) => {
            const lines = text.split('\n').filter(line => line.trim());
            if (lines.length < 2) return [];
            
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const products = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                const product = { id: Date.now() + Math.random() };
                
                headers.forEach((header, index) => {
                    const value = values[index] || '';
                    if (header.toLowerCase().includes('price')) {
                        product[header.toLowerCase()] = parseFloat(value) || 0;
                    } else {
                        product[header.toLowerCase()] = value;
                    }
                });
                
                if (!product.status) product.status = 'active';
                if (!product.sku) product.sku = 'AUTO_' + Date.now();
                if (!product.name) product.name = 'Unnamed Product';
                
                products.push(product);
            }
            return products;
        };

        const exportToJSON = (data, filename) => {
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        };

        // Mock Data
        const mockProducts = [
            { id: 1, sku: 'LAPTOP001', name: 'MacBook Pro 13"', brand: 'Apple', category: 'Laptops', price: 1299, description: 'Apple MacBook Pro 13-inch with M1 chip', status: 'active' },
            { id: 2, sku: 'LAPTOP001A', name: 'MacBook Pro 13 inch', brand: 'Apple', category: 'Computers', price: 1299, description: 'Apple MacBook Pro 13" M1 processor', status: 'active' },
            { id: 3, sku: 'PHONE001', name: 'iPhone 14', brand: 'Apple', category: 'Smartphones', price: 999, description: 'Latest iPhone 14 smartphone', status: 'active' },
            { id: 4, sku: 'PHONE001B', name: 'iPhone 14 Pro', brand: 'Apple', category: 'Mobile Phones', price: 1099, description: 'iPhone 14 Pro with advanced camera', status: 'active' },
            { id: 5, sku: 'TABLET001', name: 'Samsung Galaxy Tab', brand: 'Samsung', category: 'Tablets', price: 599, description: 'Samsung Galaxy tablet with S Pen', status: 'active' },
        ];

        // Duplicate Detection
        const calculateSimilarity = (product1, product2) => {
            let score = 0;
            let factors = 0;
            
            if (product1.sku && product2.sku) {
                const similarity = product1.sku.toLowerCase() === product2.sku.toLowerCase() ? 1 : 0.8;
                score += similarity * 0.4;
                factors += 0.4;
            }
            
            if (product1.name && product2.name) {
                const similarity = product1.name.toLowerCase().includes(product2.name.toLowerCase().substring(0, 5)) ? 0.9 : 0;
                score += similarity * 0.4;
                factors += 0.4;
            }
            
            if (product1.brand && product2.brand) {
                score += (product1.brand.toLowerCase() === product2.brand.toLowerCase() ? 1 : 0) * 0.2;
                factors += 0.2;
            }
            
            return factors > 0 ? (score / factors) * 100 : 0;
        };

        const findDuplicateGroups = (products) => {
            const groups = [];
            const processed = new Set();

            products.forEach((product, index) => {
                if (processed.has(product.id)) return;
                const group = [product];
                processed.add(product.id);

                products.slice(index + 1).forEach(otherProduct => {
                    if (processed.has(otherProduct.id)) return;
                    if (calculateSimilarity(product, otherProduct) >= 70) {
                        group.push(otherProduct);
                        processed.add(otherProduct.id);
                    }
                });

                if (group.length > 1) {
                    groups.push({
                        id: 'group_' + (groups.length + 1),
                        products: group,
                        confidence: 85,
                        status: 'pending'
                    });
                }
            });
            return groups;
        };

        // Main App Component
        const App = () => {
            const [currentView, setCurrentView] = useState('dashboard');
            const [products, setProducts] = useState(mockProducts);
            const [duplicateGroups, setDuplicateGroups] = useState([]);
            const [searchQuery, setSearchQuery] = useState('');

            useEffect(() => {
                setDuplicateGroups(findDuplicateGroups(products));
            }, [products]);

            const stats = {
                totalProducts: products.length,
                duplicateGroups: duplicateGroups.length,
                goldenRecordsFinalized: duplicateGroups.filter(g => g.status === 'finalized').length,
                completionRate: duplicateGroups.length > 0 ? Math.round((duplicateGroups.filter(g => g.status === 'finalized').length / duplicateGroups.length) * 100) : 0
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file && file.name.endsWith('.csv')) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const csvText = event.target.result;
                        const newProducts = parseCSV(csvText);
                        if (newProducts.length > 0) {
                            setProducts(prev => [...prev, ...newProducts]);
                            alert('Successfully uploaded ' + newProducts.length + ' products!');
                        } else {
                            alert('No valid products found in CSV');
                        }
                    };
                    reader.readAsText(file);
                } else {
                    alert('Please select a CSV file');
                }
            };

            const Navigation = () => (
                <nav className="bg-white shadow-sm border-b">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex justify-between h-16">
                            <div className="flex items-center">
                                <Icon name="Database" className="w-8 h-8 text-blue-600 mr-3" />
                                <span className="text-xl font-semibold text-gray-900">GoldenRecord Pro</span>
                            </div>
                            <div className="flex space-x-8">
                                {['dashboard', 'duplicates', 'products', 'upload'].map(view => (
                                    <button
                                        key={view}
                                        onClick={() => setCurrentView(view)}
                                        className={`px-3 py-2 text-sm font-medium capitalize ${
                                            currentView === view 
                                                ? 'text-blue-600 border-b-2 border-blue-600' 
                                                : 'text-gray-500 hover:text-gray-700'
                                        }`}
                                    >
                                        {view}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                </nav>
            );

            const Dashboard = () => (
                <div className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        {[
                            { title: 'Total Products', value: stats.totalProducts, icon: 'Database', color: 'blue' },
                            { title: 'Duplicate Groups', value: stats.duplicateGroups, icon: 'AlertTriangle', color: 'yellow' },
                            { title: 'Golden Records', value: stats.goldenRecordsFinalized, icon: 'CheckCircle', color: 'green' },
                            { title: 'Completion Rate', value: stats.completionRate + '%', icon: 'FileText', color: 'purple' }
                        ].map(({ title, value, icon, color }) => (
                            <div key={title} className="bg-white rounded-lg shadow p-6">
                                <div className="flex items-center">
                                    <div className={`p-3 rounded-md bg-${color}-100`}>
                                        <Icon name={icon} className={`w-6 h-6 text-${color}-600`} />
                                    </div>
                                    <div className="ml-4">
                                        <h3 className="text-lg font-medium text-gray-900">{title}</h3>
                                        <p className="text-2xl font-semibold text-gray-600">{value}</p>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    <div className="bg-white rounded-lg shadow p-6">
                        <h3 className="text-lg font-medium text-gray-900 mb-4">Application Features</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div className="flex justify-between">
                                <span>CSV Upload:</span>
                                <span className="text-green-600 font-medium">✓ Working</span>
                            </div>
                            <div className="flex justify-between">
                                <span>Product Search:</span>
                                <span className="text-green-600 font-medium">✓ Working</span>
                            </div>
                            <div className="flex justify-between">
                                <span>Duplicate Detection:</span>
                                <span className="text-green-600 font-medium">✓ Working</span>
                            </div>
                            <div className="flex justify-between">
                                <span>Data Export:</span>
                                <span className="text-green-600 font-medium">✓ Working</span>
                            </div>
                        </div>
                    </div>
                </div>
            );

            const ProductsList = () => {
                const filteredProducts = products.filter(product => 
                    !searchQuery || 
                    product.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    product.sku.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    product.brand.toLowerCase().includes(searchQuery.toLowerCase())
                );

                return (
                    <div className="space-y-6">
                        <div className="flex justify-between items-center">
                            <div className="relative">
                                <Icon name="Search" className="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" />
                                <input
                                    type="text"
                                    placeholder="Search products..."
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                    className="pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                />
                            </div>
                            <div className="flex items-center space-x-4">
                                <span className="text-sm text-gray-600">
                                    {filteredProducts.length} of {products.length} products
                                </span>
                                <button 
                                    onClick={() => exportToJSON(filteredProducts, 'products.json')}
                                    className="flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
                                >
                                    <Icon name="Download" className="w-4 h-4 mr-2" />
                                    Export
                                </button>
                            </div>
                        </div>

                        <div className="bg-white shadow rounded-lg overflow-hidden">
                            <table className="min-w-full divide-y divide-gray-200">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Product</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">SKU</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Brand</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Price</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Category</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {filteredProducts.map(product => (
                                        <tr key={product.id} className="hover:bg-gray-50">
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className="text-sm font-medium text-gray-900">{product.name}</div>
                                                <div className="text-sm text-gray-500">{product.description}</div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{product.sku}</td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{product.brand}</td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${product.price}</td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{product.category}</td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                <div className="flex space-x-2">
                                                    <button className="text-blue-600 hover:text-blue-900">
                                                        <Icon name="Eye" className="w-4 h-4" />
                                                    </button>
                                                    <button className="text-gray-600 hover:text-gray-900">
                                                        <Icon name="Edit" className="w-4 h-4" />
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            };

            const DuplicateGroups = () => (
                <div className="bg-white rounded-lg shadow">
                    <div className="px-6 py-4 border-b border-gray-200">
                        <h3 className="text-lg font-medium text-gray-900">Duplicate Groups</h3>
                        <p className="text-sm text-gray-500 mt-1">
                            {duplicateGroups.filter(g => g.status === 'pending').length} groups pending review
                        </p>
                    </div>
                    <div className="divide-y divide-gray-200">
                        {duplicateGroups.map(group => (
                            <div key={group.id} className="px-6 py-4 flex items-center justify-between">
                                <div>
                                    <p className="text-sm font-medium text-gray-900">{group.products[0].name}</p>
                                    <p className="text-sm text-gray-500">
                                        {group.products.length} products, {group.confidence}% confidence
                                    </p>
                                </div>
                                <span className="px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800">
                                    {group.status}
                                </span>
                            </div>
                        ))}
                        {duplicateGroups.length === 0 && (
                            <div className="px-6 py-8 text-center text-gray-500">
                                No duplicate groups found
                            </div>
                        )}
                    </div>
                </div>
            );

            const UploadComponent = () => (
                <div className="space-y-6">
                    <div className="bg-white rounded-lg shadow p-6">
                        <h3 className="text-lg font-medium text-gray-900 mb-4">Upload Product Data</h3>
                        <div className="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
                            <Icon name="Upload" className="w-12 h-12 mx-auto text-gray-400 mb-4" />
                            <div>
                                <label htmlFor="file-upload" className="cursor-pointer">
                                    <span className="text-lg font-medium text-gray-900 hover:text-blue-600">
                                        Click to upload CSV file
                                    </span>
                                    <input 
                                        id="file-upload" 
                                        type="file" 
                                        accept=".csv" 
                                        className="sr-only" 
                                        onChange={handleFileUpload}
                                    />
                                </label>
                                <p className="text-sm text-gray-500 mt-2">CSV files only, up to 10MB</p>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow p-6">
                        <h4 className="font-medium text-gray-900 mb-3">Expected CSV Format:</h4>
                        <div className="bg-gray-100 p-4 rounded text-sm font-mono">
                            <div>sku,name,brand,category,price,description</div>
                            <div>"PROD001","Product Name","Brand","Category",99.99,"Description"</div>
                            <div>"PROD002","Another Product","Brand","Category",149.99,"Description"</div>
                        </div>
                        <p className="text-sm text-gray-600 mt-3">
                            First row should contain column headers. Supported columns: sku, name, brand, category, price, description
                        </p>
                    </div>
                </div>
            );

            const renderView = () => {
                switch (currentView) {
                    case 'dashboard': return <Dashboard />;
                    case 'duplicates': return <DuplicateGroups />;
                    case 'products': return <ProductsList />;
                    case 'upload': return <UploadComponent />;
                    default: return <Dashboard />;
                }
            };

            return (
                <div className="min-h-screen bg-gray-100">
                    <Navigation />
                    <main className="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
                        {renderView()}
                    </main>
                    <footer className="bg-white border-t">
                        <div className="max-w-7xl mx-auto py-4 px-4 text-center">
                            <p className="text-sm text-gray-500">GoldenRecord Pro - Product Data Management System</p>
                        </div>
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
