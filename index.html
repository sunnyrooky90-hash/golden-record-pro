<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoldenRecord Pro - Product Data Deduplication</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .lucide { width: 24px; height: 24px; stroke: currentColor; stroke-width: 2; fill: none; }
        .lucide-sm { width: 16px; height: 16px; }
        .lucide-lg { width: 32px; height: 32px; }
        .table-row-selected { background-color: #dbeafe; }
        .drag-active { border-color: #3b82f6 !important; background-color: #eff6ff !important; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // Lucide React Icons
        const LucideIcon = ({ name, className = "lucide", ...props }) => {
            const icons = {
                Database: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <ellipse cx="12" cy="5" rx="9" ry="3"/>
                        <path d="m3 5 0 14c0 1.7 4 3 9 3s9-1.3 9-3V5"/>
                        <path d="m3 12c0 1.7 4 3 9 3s9-1.3 9-3"/>
                    </svg>
                ),
                Upload: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <path d="m12 18-4-4h3V9h2v5h3l-4 4z"/>
                    </svg>
                ),
                Search: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                ),
                Download: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <path d="M12 2v10"/>
                        <path d="m5 9 7 7 7-7"/>
                        <path d="M5 20h14"/>
                    </svg>
                ),
                FileText: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <polyline points="10,9 9,9 8,9"/>
                    </svg>
                ),
                Users: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="m22 21-2-2"/>
                        <path d="M16 11l2 2 4-4"/>
                    </svg>
                ),
                CheckCircle: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22,4 12,14.01 9,11.01"/>
                    </svg>
                ),
                AlertTriangle: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
                        <path d="M12 9v4"/>
                        <path d="m12 17 .01 0"/>
                    </svg>
                ),
                Eye: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                ),
                Edit: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z"/>
                    </svg>
                ),
                Trash2: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <path d="M3 6h18"/>
                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                        <line x1="10" y1="11" x2="10" y2="17"/>
                        <line x1="14" y1="11" x2="14" y2="17"/>
                    </svg>
                ),
                X: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <path d="M18 6 6 18"/>
                        <path d="m6 6 12 12"/>
                    </svg>
                ),
                ChevronDown: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <path d="m6 9 6 6 6-6"/>
                    </svg>
                ),
                ChevronRight: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <path d="m9 18 6-6-6-6"/>
                    </svg>
                ),
                Filter: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"/>
                    </svg>
                ),
                SortAsc: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <path d="M3 6h18"/>
                        <path d="M7 12h10"/>
                        <path d="M10 18h4"/>
                    </svg>
                ),
                Plus: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <path d="M5 12h14"/>
                        <path d="M12 5v14"/>
                    </svg>
                ),
                Settings: () => (
                    <svg className={className} {...props} viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                ),
            };
            
            const Icon = icons[name];
            return Icon ? <Icon /> : <div className={className}>{name}</div>;
        };

        // Utility functions
        const saveToLocalStorage = (key, data) => {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (error) {
                console.error('Failed to save to localStorage:', error);
            }
        };

        const loadFromLocalStorage = (key, defaultValue) => {
            try {
                const stored = localStorage.getItem(key);
                return stored ? JSON.parse(stored) : defaultValue;
            } catch (error) {
                console.error('Failed to load from localStorage:', error);
                return defaultValue;
            }
        };

        // CSV parsing utility
        const parseCSV = (text) => {
            const lines = text.split('\n');
            if (lines.length < 2) return [];
            
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const products = [];
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const values = line.split(',').map(v => v.trim().replace(/"/g, ''));
                const product = { id: Date.now() + i };
                
                headers.forEach((header, index) => {
                    const value = values[index] || '';
                    // Convert numeric values
                    if (header.toLowerCase().includes('price') || header.toLowerCase().includes('cost')) {
                        product[header.toLowerCase()] = parseFloat(value) || 0;
                    } else {
                        product[header.toLowerCase()] = value;
                    }
                });
                
                // Ensure required fields
                if (!product.status) product.status = 'active';
                if (!product.sku) product.sku = `AUTO_${Date.now() + i}`;
                if (!product.name) product.name = 'Unnamed Product';
                
                products.push(product);
            }
            
            return products;
        };

        // Export functions
        const exportToCSV = (data, filename) => {
            if (!data.length) return;
            
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => `"${row[header] || ''}"`).join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        };

        const exportToJSON = (data, filename) => {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        };

        // Mock data
        const generateMockProducts = () => [
            { id: 1, sku: 'LAPTOP001', name: 'MacBook Pro 13"', brand: 'Apple', category: 'Laptops', price: 1299, description: 'Apple MacBook Pro 13-inch with M1 chip', status: 'active', inventory: 15, supplier: 'Apple Inc' },
            { id: 2, sku: 'LAPTOP001A', name: 'MacBook Pro 13 inch', brand: 'Apple', category: 'Computers', price: 1299, description: 'Apple MacBook Pro 13" M1 processor', status: 'active', inventory: 12, supplier: 'Apple Inc' },
            { id: 3, sku: 'PHONE001', name: 'iPhone 14', brand: 'Apple', category: 'Smartphones', price: 999, description: 'Latest iPhone 14 smartphone', status: 'active', inventory: 25, supplier: 'Apple Inc' },
            { id: 4, sku: 'PHONE001B', name: 'iPhone 14 Pro', brand: 'Apple', category: 'Mobile Phones', price: 1099, description: 'iPhone 14 Pro with advanced camera', status: 'active', inventory: 18, supplier: 'Apple Inc' },
            { id: 5, sku: 'TABLET001', name: 'Samsung Galaxy Tab', brand: 'Samsung', category: 'Tablets', price: 599, description: 'Samsung Galaxy tablet with S Pen', status: 'active', inventory: 8, supplier: 'Samsung Electronics' },
            { id: 6, sku: 'WATCH001', name: 'Apple Watch Series 8', brand: 'Apple', category: 'Wearables', price: 399, description: 'Apple Watch with health monitoring', status: 'active', inventory: 30, supplier: 'Apple Inc' },
            { id: 7, sku: 'LAPTOP002', name: 'Dell XPS 13', brand: 'Dell', category: 'Laptops', price: 1199, description: 'Dell XPS 13 ultrabook', status: 'active', inventory: 10, supplier: 'Dell Technologies' },
            { id: 8, sku: 'PHONE002', name: 'Samsung Galaxy S23', brand: 'Samsung', category: 'Smartphones', price: 899, description: 'Samsung Galaxy S23 flagship phone', status: 'active', inventory: 22, supplier: 'Samsung Electronics' },
        ];

        // Duplicate detection algorithms
        const levenshteinDistance = (str1, str2) => {
            const matrix = [];
            for (let i = 0; i <= str2.length; i++) matrix[i] = [i];
            for (let j = 0; j <= str1.length; j++) matrix[0][j] = j;
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            return matrix[str2.length][str1.length];
        };

        const calculateSimilarity = (product1, product2) => {
            let score = 0;
            let factors = 0;

            // SKU similarity (high weight)
            if (product1.sku && product2.sku) {
                const skuSimilarity = 1 - (levenshteinDistance(product1.sku.toLowerCase(), product2.sku.toLowerCase()) / Math.max(product1.sku.length, product2.sku.length));
                score += skuSimilarity * 0.4;
                factors += 0.4;
            }

            // Name similarity (high weight)
            if (product1.name && product2.name) {
                const nameSimilarity = 1 - (levenshteinDistance(product1.name.toLowerCase(), product2.name.toLowerCase()) / Math.max(product1.name.length, product2.name.length));
                score += nameSimilarity * 0.3;
                factors += 0.3;
            }

            // Brand exact match (medium weight)
            if (product1.brand && product2.brand) {
                score += (product1.brand.toLowerCase() === product2.brand.toLowerCase() ? 1 : 0) * 0.2;
                factors += 0.2;
            }

            // Price similarity (low weight)
            if (product1.price && product2.price) {
                const priceDiff = Math.abs(product1.price - product2.price);
                const maxPrice = Math.max(product1.price, product2.price);
                const priceSimilarity = Math.max(0, 1 - (priceDiff / maxPrice));
                score += priceSimilarity * 0.1;
                factors += 0.1;
            }

            return factors > 0 ? (score / factors) * 100 : 0;
        };

        const findDuplicateGroups = (products, threshold = 70) => {
            const groups = [];
            const processed = new Set();

            products.forEach((product, index) => {
                if (processed.has(product.id)) return;

                const group = [product];
                processed.add(product.id);

                products.slice(index + 1).forEach(otherProduct => {
                    if (processed.has(otherProduct.id)) return;

                    const similarity = calculateSimilarity(product, otherProduct);
                    if (similarity >= threshold) {
                        group.push(otherProduct);
                        processed.add(otherProduct.id);
                    }
                });

                if (group.length > 1) {
                    const confidence = Math.round(group.reduce((acc, curr, i) => {
                        if (i === 0) return acc;
                        return acc + calculateSimilarity(group[0], curr);
                    }, 0) / (group.length - 1));

                    groups.push({
                        id: `group_${groups.length + 1}`,
                        products: group,
                        confidence,
                        status: 'pending',
                        suggestedGolden: selectBestGoldenRecord(group)
                    });
                }
            });

            return groups;
        };

        const selectBestGoldenRecord = (products) => {
            return products.reduce((best, current) => {
                let bestScore = 0;
                let currentScore = 0;

                // Score based on completeness
                Object.values(best).forEach(value => {
                    if (value && value.toString().trim()) bestScore++;
                });
                Object.values(current).forEach(value => {
                    if (value && value.toString().trim()) currentScore++;
                });

                // Prefer products with more complete data
                if (currentScore > bestScore) return current;
                if (bestScore > currentScore) return best;

                // If equal, prefer the one with longer description
                if (current.description && current.description.length > (best.description || '').length) {
                    return current;
                }

                return best;
            });
        };

        // Main App Component
        const App = () => {
            const [currentView, setCurrentView] = useState('dashboard');
            const [user, setUser] = useState({ name: 'John Doe', role: 'Data Steward' });
            const [products, setProducts] = useState(() => loadFromLocalStorage('products', generateMockProducts()));
            const [duplicateGroups, setDuplicateGroups] = useState([]);
            const [selectedProducts, setSelectedProducts] = useState(new Set());
            const [sortConfig, setSortConfig] = useState({ key: null, direction: 'asc' });
            const [filterConfig, setFilterConfig] = useState({ category: 'all', status: 'all', priceRange: { min: '', max: '' } });
            
            // Save products to localStorage whenever they change
            useEffect(() => {
                saveToLocalStorage('products', products);
            }, [products]);

            useEffect(() => {
                const groups = findDuplicateGroups(products);
                setDuplicateGroups(groups);
                saveToLocalStorage('duplicateGroups', groups);
            }, [products]);

            const stats = useMemo(() => ({
                totalProducts: products.length,
                duplicateGroups: duplicateGroups.length,
                goldenRecordsFinalized: duplicateGroups.filter(g => g.status === 'finalized').length,
                goldenRecordPercentage: duplicateGroups.length > 0 ? Math.round((duplicateGroups.filter(g => g.status === 'finalized').length / duplicateGroups.length) * 100) : 0,
                averagePrice: products.length > 0 ? Math.round(products.reduce((sum, p) => sum + (p.price || 0), 0) / products.length) : 0,
                lowInventoryItems: products.filter(p => p.inventory && p.inventory < 10).length,
                uniqueCategories: [...new Set(products.map(p => p.category))].length,
                uniqueBrands: [...new Set(products.map(p => p.brand))].length,
            }), [products, duplicateGroups]);

            // Bulk operations
            const deleteSelectedProducts = () => {
                if (selectedProducts.size === 0) return;
                if (confirm(`Delete ${selectedProducts.size} selected products?`)) {
                    setProducts(products.filter(p => !selectedProducts.has(p.id)));
                    setSelectedProducts(new Set());
                }
            };

            const bulkUpdateStatus = (newStatus) => {
                if (selectedProducts.size === 0) return;
                setProducts(products.map(p => 
                    selectedProducts.has(p.id) ? { ...p, status: newStatus } : p
                ));
                setSelectedProducts(new Set());
            };

            // Navigation Component
            const Navigation = () => (
                <nav className="bg-white shadow-sm border-b">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex justify-between h-16">
                            <div className="flex">
                                <div className="flex-shrink-0 flex items-center">
                                    <LucideIcon name="Database" className="lucide-lg text-blue-600" />
                                    <span className="ml-2 text-xl font-semibold text-gray-900">GoldenRecord Pro</span>
                                    <span className="ml-2 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">Enhanced</span>
                                </div>
                                <div className="hidden sm:ml-6 sm:flex sm:space-x-8">
                                    {[
                                        { id: 'dashboard', label: 'Dashboard', icon: 'FileText' },
                                        { id: 'duplicates', label: 'Duplicates', icon: 'AlertTriangle', badge: duplicateGroups.filter(g => g.status === 'pending').length },
                                        { id: 'products', label: 'Products', icon: 'Database', badge: products.length },
                                        { id: 'upload', label: 'Upload', icon: 'Upload' }
                                    ].map(({ id, label, icon, badge }) => (
                                        <button
                                            key={id}
                                            onClick={() => setCurrentView(id)}
                                            className={`inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium relative ${
                                                currentView === id
                                                    ? 'border-blue-500 text-gray-900'
                                                    : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700'
                                            }`}
                                        >
                                            <LucideIcon name={icon} className="lucide-sm mr-1" />
                                            {label}
                                            {badge > 0 && (
                                                <span className="ml-1 px-2 py-1 text-xs bg-red-100 text-red-800 rounded-full">
                                                    {badge}
                                                </span>
                                            )}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div className="flex items-center space-x-4">
                                <button
                                    onClick={() => {
                                        if (confirm('Clear all data and reset to defaults?')) {
                                            localStorage.clear();
                                            setProducts(generateMockProducts());
                                            setSelectedProducts(new Set());
                                        }
                                    }}
                                    className="text-sm text-gray-500 hover:text-gray-700"
                                >
                                    <LucideIcon name="Settings" className="lucide-sm" />
                                </button>
                                <span className="text-sm text-gray-700">Welcome, {user.name} ({user.role})</span>
                                <LucideIcon name="Users" className="lucide-sm text-gray-400" />
                            </div>
                        </div>
                    </div>
                </nav>
            );

            // Enhanced Dashboard Component
            const Dashboard = () => (
                <div className="space-y-6">
                    {/* Main Stats */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        {[
                            { title: 'Total Products', value: stats.totalProducts, icon: 'Database', color: 'blue', change: '+12%' },
                            { title: 'Duplicate Groups', value: stats.duplicateGroups, icon: 'AlertTriangle', color: 'yellow', change: '-5%' },
                            { title: 'Golden Records', value: stats.goldenRecordsFinalized, icon: 'CheckCircle', color: 'green', change: '+8%' },
                            { title: 'Completion Rate', value: `${stats.goldenRecordPercentage}%`, icon: 'FileText', color: 'purple', change: '+15%' }
                        ].map(({ title, value, icon, color, change }) => (
                            <div key={title} className="bg-white rounded-lg shadow p-6 hover:shadow-md transition-shadow">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm font-medium text-gray-600">{title}</p>
                                        <p className="text-2xl font-bold text-gray-900">{value}</p>
                                        <p className={`text-xs ${change.startsWith('+') ? 'text-green-600' : 'text-red-600'}`}>
                                            {change} from last month
                                        </p>
                                    </div>
                                    <div className={`p-3 rounded-full bg-${color}-100`}>
                                        <LucideIcon name={icon} className={`lucide text-${color}-600`} />
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Additional Stats */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div className="bg-white rounded-lg shadow p-6">
                            <h3 className="text-lg font-medium text-gray-900">Average Price</h3>
                            <p className="text-2xl font-bold text-gray-900">${stats.averagePrice}</p>
                        </div>
                        <div className="bg-white rounded-lg shadow p-6">
                            <h3 className="text-lg font-medium text-gray-900">Low Inventory</h3>
                            <p className="text-2xl font-bold text-red-600">{stats.lowInventoryItems
